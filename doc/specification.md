# 仕様書

このプロジェクトは3Dリアルタイム対戦ゲームのサーバーである。

## 機能要件

### プレイヤーマッチング

以下にプレイヤー二人がマッチングするまでのフローを示す。

1. プレイヤーAがマッチングを作成する。この際、任意のユーザー名を指定することができる。
2. サーバーはマッチングIDを生成し、待機リストに登録する。
3. プレイヤーBは以下のいずれかの方法でマッチングに参加する：
    - サーバーから参加可能なマッチング一覧を取得し、選択して参加する。
    - プレイヤーAから共有されたマッチングID（QRコードやBluetooth等で共有）を直接指定して参加する。
4. サーバーはプレイヤーAとプレイヤーBのマッチングを成立させ、両者に対してマッチング成功の通知を送信する。
5. マッチングが成立した後、プレイヤーは対戦準備画面に遷移し、使用する3Dモデルキャラクターを選択する。
6. 準備ができたプレイヤーから順に「準備完了」ボタンを押し、両者が準備完了状態になると、サーバーは両者に対してお互いの3Dモデルキャラクター情報(3Dモデルデータ、初期位置、向いている方向)を送信し、ゲームを開始する。

### ゲーム進行管理

1. サーバーはゲーム開始後、両プレイヤーからの操作入力(移動、攻撃など)をリアルタイムで受信する。
2. サーバーは受信した操作入力に基づき、ゲーム内のキャラクターの位置、状態、HPなどを計算し、ゲームの進行を管理する。
3. サーバーは定期的に、両プレイヤーに対して最新のゲーム状態(キャラクターの位置、状態、HPなど)を送信する。
4. いずれかのプレイヤーのHPが0になった場合、サーバーはゲーム終了を判定し、、両プレイヤーに対してゲーム終了通知と勝敗結果を送信する。
5. ゲーム終了後、サーバーは両プレイヤーの戦績データ(勝敗、使用キャラクター、プレイ時間など)を保存し、必要に応じてランキングシステムに反映させる。

なお、本ゲームではダメージ計算は攻撃を喰らった側のプレイヤーが行う仕様とする。

## 非機能要件

### パフォーマンス

- サーバーは1秒間に最低60回の状態更新を両プレイヤーに送信できること。
- サーバーは同時に最低1000組のマッチングを処理できること。
- サーバーの応答時間は100ms以下であること。
- サーバーは高負荷時でも安定して動作し、ゲームの進行に支障をきたさないこと。
- サーバーはスケーラブルな設計とし、将来的に複数人での対戦が可能なように拡張できること。
- サーバーは障害発生時に迅速に復旧できる仕組みを備えること。

### セキュリティ

- サーバーはプレイヤーの個人情報を適切に保護し、不正アクセスから守ること。
- サーバーは通信データを暗号化し、盗聴や改ざんを防止すること。
- サーバーは不正な操作入力やチート行為を検出し、対策を講じること。
- サーバーは定期的にセキュリティ監査を実施し、脆弱性を早期に発見・修正すること。
